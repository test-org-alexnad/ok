name: Send Slack notification on pull request
on:
  workflow_call:
    secrets:
      UCP_WEBHOOK:
        required: true
  pull_request:
    types: [ opened, reopened ]

jobs:
  github_email:
    runs-on: [self-hosted,Linux,X64,gcp,small]
    if: ${{github.base_ref == 'main}}
    steps:
      - name: Checkout
        uses: actions/checkout@v2
        with:
          ref: ${{ github.head_ref }}
          fetch-depth: 0
      - name: Get user's e-mail
        id: user_email
        run: |
          echo "email=$(git log -n 1 --pretty=format:%ae)" >> $GITHUB_ENV
  slack_PR_notification_with_github_user:
    runs-on: [ self-hosted, Linux, X64, gcp, small ]
    if: ${{ github.base_ref == 'main' && (env.email == *'@users.noreply.github.com'* || env.email == 'null'}}
    steps:
      - name: invalid email
        run: |
          echo "${{env.email}}"
  slack_PR_notification_with_slack_user:
    runs-on: [ self-hosted, Linux, X64, gcp, small ]
    if: ${{ github.base_ref == 'main'}}
    steps:
      - name: Find Slack user
        id: find-slack-user
        uses: scribd/find-slack-user-action@v1
        with:
          email: ${{env.email}}
          slack-token: ${{ secrets.SLACK_API_TOKEN }}
      - name: show
        run: |
          echo "${{ steps.find-slack-user.outputs.username}}"
